{{ $architecture := or .architecture "arm64" }}
{{ $suite := or .suite "bullseye" }}
{{ $osvideopack := or .osvideopack (printf "osvideopack-%s-%s" $suite $architecture) }}
{{ $osmodelpack := or .osmodelpack (printf "osmodelpack-%s-%s" $suite $architecture) }}

architecture: {{ $architecture }}

actions:
  - action: unpack
    description: Unpack osvideopack
    file: {{ $osvideopack }}.tar.gz

  - action: overlay
    description: Packages overlay
    source: overlay
    destination: /opt

  - action: run
    description: Install camera-engine-rkaiq
    chroot: true
    command: |
      set -e
      dpkg -i /opt/packages/camera-engine-rkaiq_3.0.2_arm64.deb

  - action: pack
    description: Pack into tarball
    file: {{ $osmodelpack }}.tar.gz
